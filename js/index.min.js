window.onload=function(){document.getElementsByClassName("start")[0].onclick=function(){this.style.display="none",Game.init()}};var Game={enemy:{em1:{style:"enemy1",hp:"1",score:"1",speed:10},em2:{style:"enemy2",hp:"2",score:"3",speed:20},em3:{style:"enemy3",hp:"3",score:"5",speed:30}},checkpoint:[{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:10,timer:2500},{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:10,timer:2e3},{data:["em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:20,timer:1e3}],airData:{air1:{style:"air",speed:10,bullet:"bullet"}},level:0,maxLevel:3,init:function(){this.createScore(),this.createEnemy(this.checkpoint[this.level]),this.createAir(),this.level++},createScore:function(){var e=document.createElement("div"),t=document.getElementsByClassName("box")[0];this.oBox=t,e.className="score",e.innerHTML="积分：<span>0</span>",t.appendChild(e);var m=e.getElementsByTagName("span")[0];this.oSpan=m},createEnemy:function(e){var t=e.data,m=[],o=this,s=document.createElement("ul");s.style.width=40*e.iNum+"px",s.className="honeycomb",this.oUl=s,this.oBox.appendChild(s),s.style.left=(this.oBox.offsetWidth-s.offsetWidth)/2+"px";for(var i=0;i<t.length;i++){(l=document.createElement("li")).className=this.enemy[t[i]].style,l.hp=this.enemy[t[i]].hp,l.score=this.enemy[t[i]].score,l.speed=this.enemy[t[i]].speed,s.appendChild(l)}var l=s.getElementsByTagName("li");this.oLi=l;for(var f=0;f<l.length;f++)m.push([l[f].offsetLeft,l[f].offsetTop]);for(var n=0;n<l.length;n++)l[n].style.position="absolute",l[n].style.left=m[n][0]+"px",l[n].style.top=m[n][1]+"px";this.enemyMove(e),setInterval(function(){o.random()},e.timer)},enemyMove:function(e){var t=this;t.oUl.timer=null;var m=0,o=this.oBox.offsetWidth-this.oUl.offsetWidth;t.oUl.timer=setInterval(function(){t.oUl.offsetLeft>=o?(e.speedX*=-1,t.oUl.style.top=t.oUl.offsetTop+e.speedY+"px"):t.oUl.offsetLeft<=m&&(e.speedX*=-1,t.oUl.style.top=t.oUl.offsetTop+e.speedY+"px"),t.oUl.style.left=t.oUl.offsetLeft+e.speedX+"px"},200)},createAir:function(){var e=document.createElement("div");e.className=this.airData.air1.style,this.oAir=e,this.oBox.appendChild(e),e.style.left=(this.oBox.offsetWidth-e.offsetWidth)/2+"px",e.style.top=this.oBox.offsetHeight-e.offsetHeight+"px",this.airMove(this.airData.air1)},airMove:function(e){function t(){1==s?m.oAir.style.left=m.oAir.offsetLeft-e.speed+"px":2==s&&(m.oAir.style.left=m.oAir.offsetLeft+e.speed+"px")}var m=this,o=null,s=0;document.onkeydown=function(e){o||(o=setInterval(t,20));37==(e=e||window.event).keyCode?s=1:39==e.keyCode&&(s=2)},document.onkeyup=function(e){37==(e=e||window.event).keyCode?(clearInterval(o),s=0,o=null):39==e.keyCode?(clearInterval(o),s=0,o=null):32==e.keyCode&&m.createBullet()}},createBullet:function(){var e=document.createElement("div");e.className="bullet",this.oBox.appendChild(e),e.style.left=this.oAir.offsetLeft+this.oAir.offsetWidth/2-e.offsetWidth/2+"px",e.style.top=this.oBox.offsetHeight-this.oAir.offsetHeight-e.offsetHeight-4+"px",this.bulletMove(e)},bulletMove:function(e){var t=this;e.timer=null,e.timer=setInterval(function(){e.offsetTop<=t.oBox.offsetTop-e.offsetHeight?(clearInterval(e.timer),t.oBox.removeChild(e)):e.style.top=e.offsetTop-10+"px";for(var m=0;m<t.oLi.length;m++)t.collision(e,t.oLi[m])&&(1==t.oLi[m].hp?(t.oSpan.innerText=parseInt(t.oSpan.innerText)+parseInt(t.oLi[m].score),clearInterval(t.oLi[m].timer),t.oUl.removeChild(t.oLi[m])):t.oLi[m].hp--,clearInterval(e.timer),t.oBox.removeChild(e),0==t.oLi.length&&(t.level==t.maxLevel?(document.getElementsByClassName("end")[0].style.display="block",clearInterval(t.oUl.timer),t.oBox.removeChild(t.oUl)):(clearInterval(t.oUl.timer),t.oBox.removeChild(t.oUl),t.createEnemy(t.checkpoint[t.level]),t.level++)))},50)},random:function(){var e=this,t=this.oLi[parseInt(this.oLi.length*Math.random())];t.timer=null,t.timer=setInterval(function(){var m=e.oAir.offsetLeft+e.oAir.offsetWidth/2-(t.offsetLeft+e.oUl.offsetLeft+t.offsetWidth/2),o=e.oAir.offsetTop+e.oAir.offsetHeight/2-(t.offsetTop+e.oUl.offsetTop+t.offsetHeight/2),s=Math.sqrt(m*m+o*o),i=t.speed*m/s,l=t.speed*o/s;t.style.left=t.offsetLeft+i+"px",t.style.top=t.offsetTop+l+"px",e.collision(e.oAir,t)&&(alert("游戏结束"),window.location.reload())},80)},collision:function(e,t){var m=e.offsetLeft,o=e.offsetLeft+e.offsetWidth,s=e.offsetTop,i=e.offsetTop+e.offsetHeight,l=t.offsetLeft+this.oUl.offsetLeft,f=t.offsetLeft+this.oUl.offsetLeft+t.offsetWidth,n=t.offsetTop+this.oUl.offsetTop,a=t.offsetTop+this.oUl.offsetTop+t.offsetHeight;return!(m>f||o<l||s>a||i<n)}};
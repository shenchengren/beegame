window.onload=function(){document.getElementsByClassName("start")[0].onclick=function(){this.style.display="none",Game.init()}};var Game={enemy:{em1:{style:"enemy1",hp:"1",score:"3",scorePlus:2,speed:10},em2:{style:"enemy2",hp:"2",score:"5",scorePlus:5,speed:20},em3:{style:"enemy3",hp:"3",score:"10",scorePlus:10,speed:30},em4:{style:"enemy4",hp:"5",score:"20",scorePlus:15,speed:50}},checkpoint:[{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:10,timer:2500},{data:["em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:10,timer:2e3},{data:["em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:10,speedY:20,timer:1e3},{data:["em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:30,speedY:40,timer:600},{data:["em3","em4","em3","em4","em3","em4","em3","em4","em3","em4","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em3","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em2","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1","em1"],iNum:10,speedX:30,speedY:40,timer:600}],airData:{air1:{style:"air",speed:10,bullet:"bullet",bulletNum:1,hp:1}},tipsData:["左右移动 ← →，","空格 开枪，","强化生命（100）：↑，","强化飞机（300）：↓"],level:0,maxLevel:5,init:function(){this.createScore(),this.createTips(),this.createEnemy(this.checkpoint[this.level]),this.createAir(),this.level++},createScore:function(){var e=document.createElement("div"),m=document.getElementsByClassName("box")[0];this.oBox=m,e.className="score",e.innerHTML="积分：<span>0</span>",m.appendChild(e);var t=e.getElementsByTagName("span")[0];this.oSore=t},createTips:function(){var e=document.createElement("div");e.className="tips";var m="";this.tipsData.forEach(function(e,t){m+=e}),e.innerText=m,this.oTips=e,this.oBox.appendChild(e)},createEnemy:function(e){var m=e.data,t=[],o=this,i=document.createElement("ul");i.style.width=40*e.iNum+"px",i.className="honeycomb",this.oUl=i,this.oUl.rdTiemr=null,this.oBox.appendChild(i),i.style.left=(this.oBox.offsetWidth-i.offsetWidth)/2+"px";for(var s=0;s<m.length;s++){var r=Math.random();(l=document.createElement("li")).className=this.enemy[m[s]].style,l.hp=this.enemy[m[s]].hp,l.score=parseInt(this.enemy[m[s]].score)+parseInt(this.enemy[m[s]].scorePlus*r),l.speed=this.enemy[m[s]].speed,i.appendChild(l)}var l=i.getElementsByTagName("li");this.oLi=l;for(var f=0;f<l.length;f++)t.push([l[f].offsetLeft,l[f].offsetTop]);for(var n=0;n<l.length;n++)l[n].style.position="absolute",l[n].style.left=t[n][0]+"px",l[n].style.top=t[n][1]+"px";this.enemyMove(e),this.oUl.rdTiemr=setInterval(function(){o.random()},e.timer)},enemyMove:function(e){var m=this;m.oUl.timer=null;var t=0,o=this.oBox.offsetWidth-this.oUl.offsetWidth;m.oUl.timer=setInterval(function(){m.oUl.offsetLeft>=o?(e.speedX*=-1,m.oUl.style.top=m.oUl.offsetTop+e.speedY+"px"):m.oUl.offsetLeft<=t&&(e.speedX*=-1,m.oUl.style.top=m.oUl.offsetTop+e.speedY+"px"),m.oUl.style.left=m.oUl.offsetLeft+e.speedX+"px"},200)},createAir:function(){var e=document.createElement("div");e.className=this.airData.air1.style,e.speed=this.airData.air1.speed,e.hp=this.airData.air1.hp,e.bulletNum=this.airData.air1.bulletNum,e.innerText=e.hp,this.oAir=e,this.oBox.appendChild(e),e.style.left=(this.oBox.offsetWidth-e.offsetWidth)/2+"px",e.style.top=this.oBox.offsetHeight-e.offsetHeight+"px",this.airMove()},airMove:function(){function e(){1==t?m.oAir.offsetLeft>=0?m.oAir.style.left=m.oAir.offsetLeft-m.oAir.speed+"px":clearInterval(m.oAir.timer):2==t&&(m.oAir.offsetLeft<=m.oBox.offsetWidth-m.oAir.offsetWidth?m.oAir.style.left=m.oAir.offsetLeft+m.oAir.speed+"px":clearInterval(m.oAir.timer))}var m=this;this.oAir.timer=null;var t=0;document.onkeydown=function(o){m.oAir.timer||(m.oAir.timer=setInterval(e,20));37==(o=o||window.event).keyCode?t=1:39==o.keyCode&&(t=2)},document.onkeyup=function(e){if(37==(e=e||window.event).keyCode)clearInterval(m.oAir.timer),t=0,m.oAir.timer=null;else if(39==e.keyCode)clearInterval(m.oAir.timer),t=0,m.oAir.timer=null;else if(38==e.keyCode&&m.oSore.innerText>=100)m.oSore.innerText-=100,m.oAir.innerText++;else if(40==e.keyCode&&m.oSore.innerText>=300)m.oSore.innerText-=300,m.oAir.bulletNum++;else if(32==e.keyCode)for(var o=0;o<m.oAir.bulletNum;o++)m.createBullet()}},createBullet:function(){var e=document.createElement("div");e.className="bullet",this.oBox.appendChild(e),e.style.left=this.oAir.offsetLeft+this.oAir.offsetWidth/2-e.offsetWidth/2+"px",e.style.top=this.oBox.offsetHeight-this.oAir.offsetHeight-e.offsetHeight-4+"px",this.bulletMove(e)},bulletMove:function(e){var m=this;e.timer=null,e.timer=setInterval(function(){e.offsetTop<=m.oBox.offsetTop-e.offsetHeight?(clearInterval(e.timer),m.oBox.removeChild(e)):e.style.top=e.offsetTop-10+"px";for(var t=0;t<m.oLi.length;t++)if(m.collision(e,m.oLi[t])){if(1==m.oLi[t].hp){var o=document.createElement("span");o.className="scoretext",o.style.left=e.offsetLeft+"px",o.style.top=e.offsetTop+"px",o.innerText="+"+parseInt(m.oLi[t].score),m.oBox.appendChild(o),setTimeout(function(){m.oBox.removeChild(o)},800),m.oSore.innerText=parseInt(m.oSore.innerText)+parseInt(m.oLi[t].score),clearInterval(m.oLi[t].timer),m.oUl.removeChild(m.oLi[t])}else m.oLi[t].hp--;clearInterval(e.timer),m.oBox.removeChild(e),0==m.oLi.length&&(m.level==m.maxLevel?(document.getElementsByClassName("end")[0].style.display="block",clearInterval(m.oUl.timer),m.oBox.removeChild(m.oUl)):(clearInterval(m.oUl.timer),m.oBox.removeChild(m.oUl),m.createEnemy(m.checkpoint[m.level]),m.level++))}},30)},random:function(){var e=this,m=this.oLi[parseInt(this.oLi.length*Math.random())];m.timer=null,m.timer=setInterval(function(){var t=e.oAir.offsetLeft+e.oAir.offsetWidth/2-(m.offsetLeft+e.oUl.offsetLeft+m.offsetWidth/2),o=e.oAir.offsetTop+e.oAir.offsetHeight/2-(m.offsetTop+e.oUl.offsetTop+m.offsetHeight/2),i=Math.sqrt(t*t+o*o),s=m.speed*t/i,r=m.speed*o/i;m.style.left=m.offsetLeft+s+"px",m.style.top=m.offsetTop+r+"px",e.collision(e.oAir,m)&&(1==e.oAir.innerText?(clearInterval(e.oUl.rdTiemr),alert("游戏结束"),window.location.reload()):(e.oUl.removeChild(m),e.oAir.innerText--))},80)},collision:function(e,m){var t=e.offsetLeft,o=e.offsetLeft+e.offsetWidth,i=e.offsetTop,s=e.offsetTop+e.offsetHeight,r=m.offsetLeft+this.oUl.offsetLeft,l=m.offsetLeft+this.oUl.offsetLeft+m.offsetWidth,f=m.offsetTop+this.oUl.offsetTop,n=m.offsetTop+this.oUl.offsetTop+m.offsetHeight;return!(t>l||o<r||i>n||s<f)}};